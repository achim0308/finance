{% extends 'returns/base.html' %}

{% block preheader_block %}
{% if segPerf or chart_asset_history %}
{% load nvd3_tags %}
{% endif %}
{% endblock preheader_block%}

{% block header_block%}

{% load staticfiles %}

<link rel="stylesheet" type="text/css" href="{% static 'returns/css/jquery-tablesorter/theme.bootstrap.css'%}"/>

<script type="text/javascript" src="{% static 'returns/js/jquery.tablesorter.js'%} "></script>
<script type="text/javascript" src="{% static 'returns/js/jquery.tablesorter.widgets.js'%} "></script>
<script type="text/javascript" src="{% static 'returns/js/jquery.tablesorter.widgets/widget-alignChar.js'%} "></script>

{% if segPerf or chart_asset_history %}
<link rel="stylesheet" type="text/css" href="{% static 'returns/css/nv.d3.min.css'%}"/>
<script type="text/javascript" src="{% static 'returns/js/d3.min.js'%} "></script>
<script type="text/javascript" src="{% static 'returns/js/nv.d3.min.js'%} "></script>

{% if segPerf %}

{% load_chart chart_asset_alloc.charttype chart_asset_alloc.chartdata chart_asset_alloc.chartcontainer chart_asset_alloc.extra %}
{% load_chart chart_asset_perf.charttype chart_asset_perf.chartdata chart_asset_perf.chartcontainer chart_asset_perf.extra %}

{% endif %}

{% if chart_asset_history %}

{% load_chart chart_asset_history.charttype chart_asset_history.chartdata chart_asset_history.chartcontainer chart_asset_history.extra %}

{% endif %}
{% endif %}
<script language="javascript">
$(document).ready(function()
  {
    $("#hist_perf").tablesorter(
      {
        headerTemplate: '{content} {icon}',
        widgets: ['zebra', 'uitheme', 'alignChar'],
        theme: 'bootstrap'
      });
    $("#transaction_history").tablesorter(
      {
        headerTemplate: '{content} {icon}',
        dateFormat: 'mmddyyyy',
        widgets: ['zebra', 'uitheme', 'alignChar'],
        theme: 'bootstrap'
      });
  }
);
</script>

<style>
/* CSS needed for this widget */
.ts-align-wrap {
  white-space: nowrap;
  width: 100%;
  overflow: hidden;
}
.ts-align-wrap, .ts-align-left, .ts-align-right {
  display: inline-block;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}
.ts-align-left {
  text-align:right;
}
.ts-align-right {
  text-align:left;
}
</style>

{% load djmoney %}

{% block add_header_block %}{% endblock add_header_block%}
{% endblock header_block%}

{% block body_block%}
{% block add_body_block%} {% endblock add_body_block%}

<h2>Financial performance</h2>
<p><strong>Return:</strong> {{ returns|floatformat:1 }}% (<a href="{% url 'returns:inflation_latest' %}">Inflation</a>: {{ inflation|floatformat:1 }}%)</p>

<p><strong>Total:</strong> {{ total }}
{% if cur_num %} (<strong>&#35;</strong> {{ cur_num }} ){% endif %}</p>

{% if segPerf %}
<h2><a href="#" onclick="toggle_visibility('seg-perf-div');">Segments performance</a></h2>
<div id="seg-perf-div" style="display:none">
<table class="table table-condensed" id="seg_perf">
<thead>
  <tr>
    <th></th>
    <th>YTD return</th>
    <th>Last year return</th>
    <th>Overall return</th>
    <th>Total value</th>
    <th>Of total</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th class="row">Savings</th>
    <td class="text-right">{{ segPerf.TG.rYTD|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.TG.r1Y|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.TG.rInfY|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.TG.tYTD }}</td>
    <td class="text-right">{{ segPerf.TG.frac|floatformat:1 }}%</td>
  </tr>
  <tr>
    <th class="row">Stock</th>
    <td class="text-right">{{ segPerf.AK.rYTD|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.AK.r1Y|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.AK.rInfY|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.AK.tYTD }}</td>
    <td class="text-right">{{ segPerf.AK.frac|floatformat:1 }}%</td>
  </tr>
  <tr>
    <th class="row">Stock-ETF</th>
    <td class="text-right">{{ segPerf.AF.rYTD|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.AF.r1Y|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.AF.rInfY|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.AF.tYTD }}</td>
    <td class="text-right">{{ segPerf.AF.frac|floatformat:1 }}%</td>
  </tr>
  <tr>
    <th class="row">Bonds</th>
    <td class="text-right">{{ segPerf.BD.rYTD|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.BD.r1Y|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.BD.rInfY|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.BD.tYTD }}</td>
    <td class="text-right">{{ segPerf.BD.frac|floatformat:1 }}%</td>
  </tr>
  <tr>
    <th class="row">Bonds-ETF</th>
    <td class="text-right">{{ segPerf.BF.rYTD|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.BF.r1Y|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.BF.rInfY|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.BF.tYTD }}</td>
    <td class="text-right">{{ segPerf.BF.frac|floatformat:1 }}%</td>
  </tr>
  <tr>
    <th class="row">Retirement</th>
    <td class="text-right">{{ segPerf.AV.rYTD|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.AV.r1Y|floatformat:1}}%</td>
    <td class="text-right">{{ segPerf.AV.rInfY|floatformat:1 }}%</td>
    <td class="text-right">{{ segPerf.AV.tYTD }}</td>
    <td class="text-right">{{ segPerf.AV.frac|floatformat:1 }}%</td>
  </tr>
</tbody>
</table>
</div>

{% include_container chart_asset_perf.chartcontainer 450 '100%' %}
{% include_container chart_asset_alloc.chartcontainer 450 450 %}
{% endif %}

{% if histPerf %}
<h2><a href="#" onclick="toggle_visibility('hist-perf-div');">Historical performance</a></h2>
<div id="hist-perf-div" style="display:block">
<table id="hist_perf">
<thead>
  <tr>
    <th>Time span</th>
    <th data-align-char="." data-align-adjust="05">Initial value</th>
    <th data-align-char="." data-align-adjust="10">Annualized return</th>
    <th data-align-char="." data-align-adjust="10">Inflation</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>YTD</td>
    <td>{{ histPerf.iYTD }}</td>
    <td>{{ histPerf.rYTD|floatformat:1 }}%</td>
    <td>{{ histPerf.inYTD|floatformat:1 }}%</td>
  </tr>
  <tr>
    <td>Last year</td>
    <td>{{ histPerf.i1Y }}</td>
    <td>{{ histPerf.r1Y|floatformat:1 }}%</td>
    <td>{{ histPerf.in1Y|floatformat:1 }}%</td>
  </tr>
  <tr>
    <td>Last 5 years</td>
    <td>{{ histPerf.i5Y }}</td>
    <td>{{ histPerf.r5Y|floatformat:1 }}%</td>
    <td>{{ histPerf.in5Y|floatformat:1 }}%</td>
  </tr>
  <tr>
    <td>Overall</td>
    <td>{{ histPerf.iInfY }}</td>
    <td>{{ histPerf.rInfY|floatformat:1 }}%</td>
    <td>{{ histPerf.inInfY|floatformat:1 }}%</td>
  </tr>
</tbody>
</table>
</div>
{% endif %}

{% if chart_asset_history %}
{% include_container chart_asset_history.chartcontainer 450 '100%' %}
{% endif %}

{% if transaction_list %}
<h2><a href="#" onclick="toggle_visibility('transactions-list-div');">Transaction history</a></h2>
{% include "returns/t-history.html" %}
{% endif %}
{% endblock body_block%}
